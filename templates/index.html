<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>WinJar</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="wrap">
  <header>
    <h1 class="title">WinJar</h1>
    <p class="sub">Capture small wins, keep your streak, and add context when you want to reflect.</p>
  </header>

  <div class="content">
    <!-- LEFT COLUMN --------------------------------------------------- -->
    <div>
      <!-- Card 1: streak + add + today -->
      <section class="card">
        <div class="card-body">
          <!-- Banners -->
          <div class="banner">
            <strong>Streak:</strong> {{ streak }} day(s) — {{ banner }}
          </div>
          <div class="banner">
            <strong>Weekly Summary:</strong> {{ weekly_summary }}
          </div>

          <!-- Add a win -->
          <h3>Add a win</h3>
          <form method="POST" action="/add" class="toolbar"
                style="flex-direction: column; align-items: flex-start; gap: 10px;">
            <!-- Row 1: full-width text box -->
            <input
              type="text"
              name="text"
              class="win-input"
              placeholder="{{ prompt or 'What’s one small win worth capturing right now?' }}"
              required
            >

            <!-- Row 2: mood + category + add button -->
            <div style="display: flex; gap: 10px; width: 100%; flex-wrap: wrap;">
              <select name="mood" style="flex: 1;">
                <option value="">Mood</option>
                <option value="disapointed">Stressed</option>
                <option value="sad">Stressed</option>
                <option value="stressed">Stressed</option>
                <option value="anxious">Anxious</option>
                <option value="tired">Tired</option>
                <option value="okay">Okay</option>
                <option value="focused">Focused</option>
                <option value="motivated">Motivated</option>
                <option value="grateful">Grateful</option>
                <option value="hopeful">Hopeful</option>
                <option value="joyful">Great</option>
              </select>

              <select name="category" style="flex: 1;">
                <option value="">Category</option>
                <option value="school">School</option>
                <option value="health">Health</option>
                <option value="social">Social</option>
                <option value="faith">Faith</option>
              </select>

              <button type="submit">Add</button>
            </div>
          </form>

          <!-- Optional elaboration after a new win -->
          {% if new_id %}
            <div class="entry" style="margin-top:14px;">
              <form method="POST" action="/elaborate">
                <input type="hidden" name="entry_id" value="{{ new_id }}">
                <label for="details"><strong>Elaborate (optional):</strong></label>
                <textarea
                  name="details"
                  id="details"
                  placeholder="Add context: what was challenging, how you handled it, what you learned."
                ></textarea>
                <div style="margin-top:8px;">
                  <button type="submit">Save elaboration</button>
                </div>
              </form>
            </div>
          {% endif %}

          <!-- Today section -->
          <h3 style="margin-top:18px;">Today</h3>
          {% if entries_today %}
            {% for e in entries_today %}
              <div class="entry">
                <div>
                  <strong>Win</strong>
                  {% if e.category %}<span class="pill">{{ e.category }}</span>{% endif %}
                  {% if e.mood %}<span class="pill">{{ e.mood }}</span>{% endif %}
                </div>
                <div>{{ e.text }}</div>
                {% if e.details %}
                  <div style="margin-top:8px;"><em>{{ e.details }}</em></div>
                {% endif %}
                <div class="meta">{{ e.timestamp }}</div>
              </div>
            {% endfor %}
          {% else %}
            <div class="entry">No entries yet today — one tiny note starts your streak.</div>
          {% endif %}
        </div>
      </section>

      <!-- Card 2: Tips (bottom-left) -->
      <section class="card" style="margin-top:16px;">
        <div class="card-body">
          <h3>Tips</h3>
          <ul class="tips-list">
            <li>Keep quick wins short—under 10 seconds to log.</li>
            <li>Use the Elaborate box when you want to add context.</li>
            <li>Set your mood to personalize the prompt.</li>
          </ul>
        </div>
      </section>
    </div>

    <!-- RIGHT COLUMN --------------------------------------------------- -->
    <aside>
      <!-- History on top-right -->
      <section class="card">
        <div class="card-body">
          <h3>Last 7 days
            <span class="history-link">
              <a href="{{ url_for('full_history') }}">View all history</a>
            </span>
          </h3>
          {% if history_dates %}
            {% for d in history_dates %}
              <div class="entry history-day" style="margin-top:6px;">
                <div class="meta"><strong>{{ d }}</strong></div>
                {% for e in history[d] %}
                  <div style="margin-top:4px;">
                    <div>
                      <strong>Win</strong>
                      {% if e.category %}<span class="pill">{{ e.category }}</span>{% endif %}
                      {% if e.mood %}<span class="pill">{{ e.mood }}</span>{% endif %}
                    </div>
                    <div>{{ e.text }}</div>
                    {% if e.details %}
                      <div style="margin-top:4px;"><em>{{ e.details }}</em></div>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            {% endfor %}
          {% else %}
            <div class="entry">No history yet — once you have a few days logged, you’ll see them here.</div>
          {% endif %}
        </div>
      </section>

      <!-- Export under history -->
      <section class="card" style="margin-top:12px;">
        <div class="card-body">
          <h3>Export</h3>
          <p><a href="/export">Download JSON export</a></p>
        </div>
      </section>
    </aside>
  </div>
</div>
</body>
</html>
